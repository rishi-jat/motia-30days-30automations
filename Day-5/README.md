# ğŸš€ Day-5: AI X (Twitter) Auto-Posting Workflow

**Part of #30Days30Automations Challenge**

Source inspiration: **n8n AI tweet generator â†’ Motia implementation**

---

## ğŸ“– Overview

Day-5 converts a common **n8n workflow** into a production-ready Motia automation that:

1. âœ… Accepts a POST request with a "tweet idea"
2. ğŸ¤– AI generates 3 improved tweet variations
3. ğŸ¯ Automatically selects the best version
4. ğŸ¦ Posts to X (Twitter) using X API v2
5. ğŸ“ Writes a `TWEET_RESULT.md` file locally
6. ğŸ”— Returns the tweet URL + selected text

### Key Features

- **AI-Powered Generation**: Uses OpenAI GPT-4 to create engaging tweets
- **Smart Selection**: Automatically picks the best variation
- **Mock Mode**: Test without posting to real X API
- **Caching**: Efficient AI response caching (1-hour TTL)
- **Full DDD Architecture**: Clean service boundaries
- **Type-Safe**: Zod validation throughout
- **Error Handling**: Custom error classes for each layer

---

## ğŸ—ï¸ Architecture

### Workflow Steps

```
POST /tweet
    â†“
1. Receive Idea          â†’ event: tweet.idea.received
    â†“
2. Generate Variations   â†’ event: tweet.variations.generated   [cached]
    â†“
3. Select Best Tweet     â†’ event: tweet.best.selected
    â†“
4. Post to X API        â†’ event: tweet.posted.success
    â†“
5. Write Result File     â†’ TWEET_RESULT.md
```

### Services (DDD Pattern)

```
src/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â””â”€â”€ generate-tweet.ts    # OpenAI integration
â”‚   â”œâ”€â”€ xapi/
â”‚   â”‚   â”œâ”€â”€ post-tweet.ts        # X API v2 posting
â”‚   â”‚   â””â”€â”€ types.ts             # Type definitions
â”‚   â””â”€â”€ file/
â”‚       â””â”€â”€ write-result.ts      # Markdown file writer
â”œâ”€â”€ errors/
â”‚   â””â”€â”€ tweet-errors.ts          # Custom error classes
â””â”€â”€ middlewares/                  # (Future: rate limiting, etc.)
```

---

## ğŸš€ Quick Start

### 1. Install Dependencies

```bash
cd Day-5
npm install --legacy-peer-deps
```

> **Note**: The `--legacy-peer-deps` flag resolves the Zod version conflict between OpenAI (requires zod@^3) and Motia (uses zod@^4).

### 2. Configure Environment

Copy `.env.example` to `.env`:

```bash
cp .env.example .env
```

Edit `.env`:

```env
# Required for AI generation
OPENAI_API_KEY=sk-your-openai-key-here

# Required for real X posting (optional in mock mode)
X_BEARER_TOKEN=your-x-bearer-token-here

# Output file path
OUTPUT_PATH=./TWEET_RESULT.md

# Mock mode (true = don't post to real X)
MOCK_X=true
```

### 3. Run the Workflow

```bash
npm run dev
```

Server starts at: `http://localhost:3005`

---

## ğŸ“¡ API Usage

### POST /tweet

**Request:**

```bash
curl -X POST http://localhost:3005/tweet \
  -H "Content-Type: application/json" \
  -d '{
    "idea": "Just shipped a new feature that makes developers 10x more productive"
  }'
```

**Response:**

```json
{
  "success": true,
  "message": "Tweet idea received successfully",
  "idea": "Just shipped a new feature that makes developers 10x more productive"
}
```

### Expected Output

After the workflow completes, check:

1. **Console Logs**: Watch steps turn green in terminal
2. **TWEET_RESULT.md**: View generated variations and results
3. **Return Data**: Final step returns tweet URL

---

## ğŸ§ª Testing

### Mock Mode (Default)

Set in `.env`:

```env
MOCK_X=true
```

This will:
- âœ… Generate real AI variations
- âœ… Select best tweet
- âœ… Write TWEET_RESULT.md
- âŒ **NOT** post to real X API
- âœ… Return mock tweet ID/URL

**Perfect for local testing without Twitter credentials!**

### Real Mode

Set in `.env`:

```env
MOCK_X=false
X_BEARER_TOKEN=your-real-bearer-token
```

This will post to your actual X (Twitter) account.

### Full Test Flow

1. Start the server:
   ```bash
   npm run dev
   ```

2. Send a test request:
   ```bash
   curl -X POST http://localhost:3005/tweet \
     -H "Content-Type: application/json" \
     -d '{"idea": "Testing my new AI tweet automation ğŸš€"}'
   ```

3. Watch the console for step progression:
   ```
   âœ“ Receive Tweet Idea
   âœ“ Generate Tweet Variations
   âœ“ Select Best Tweet
   âœ“ Post Tweet to X
   âœ“ Write Tweet Result
   ```

4. Check `TWEET_RESULT.md` for full output

---

## ğŸ“Š TWEET_RESULT.md Example

```markdown
# ğŸ¦ Tweet Result

## Original Idea
```
Testing my new AI tweet automation ğŸš€
```

---

## Generated Variations

### Variation 1
**Length:** 67 chars | **Has Hashtags:** Yes

```
Just tested my AI tweet automation ğŸš€ Works like magic! #automation
```

### Variation 2
...

---

## âœ… Selected Tweet (Best)
**Length:** 58 chars | **Has Hashtags:** No

```
My AI tweet automation is live and working perfectly! ğŸš€
```

---

## ğŸš€ Post Result

- **Tweet ID:** `mock-1701634800000`
- **Tweet URL:** https://x.com/mock-user/status/mock-1701634800000
- **Posted At:** 2024-12-03T16:30:00.000Z
- **Mock Mode:** âœ… Yes (Testing)

---

**Generated by Day-5 AI X Auto-Posting Workflow** ğŸ¤–
```

---

## ğŸ›ï¸ Motia Workbench

To visualize and monitor the workflow:

1. Open Motia Workbench (if installed)
2. Import this workflow
3. Trigger `/tweet` endpoint
4. Watch real-time step execution
5. View event flow and data transformations

---

## ğŸ”§ Configuration Details

### AI Tweet Generation

- **Model**: GPT-4 Turbo
- **Temperature**: 0.8 (creative)
- **Max Tokens**: 500
- **Constraints**:
  - 280 character limit
  - Human, conversational tone
  - Strategic hashtag use (1-2 max)
  - Minimal emojis
  - Clean and simple

### Best Tweet Selection Logic

Prioritizes:
1. **Shortest** length (conciseness)
2. **Clearest** content (fewer special chars)
3. **Under 280** characters
4. **High readability**

### Caching Strategy

- **Key**: `tweet-variations:{idea}`
- **TTL**: 1 hour (3600s)
- **Purpose**: Avoid re-generating same variations

---

## ğŸ“ Project Structure

```
Day-5/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”‚   â””â”€â”€ generate-tweet.ts      # OpenAI service
â”‚   â”‚   â”œâ”€â”€ xapi/
â”‚   â”‚   â”‚   â”œâ”€â”€ post-tweet.ts          # X API service
â”‚   â”‚   â”‚   â””â”€â”€ types.ts               # Type definitions
â”‚   â”‚   â””â”€â”€ file/
â”‚   â”‚       â””â”€â”€ write-result.ts        # File writer
â”‚   â”œâ”€â”€ errors/
â”‚   â”‚   â””â”€â”€ tweet-errors.ts            # Custom errors
â”‚   â””â”€â”€ middlewares/                    # (Future extensions)
â”œâ”€â”€ steps/
â”‚   â””â”€â”€ day-5/
â”‚       â”œâ”€â”€ 01-receive-idea.step.ts
â”‚       â”œâ”€â”€ 02-generate-variations.step.ts
â”‚       â”œâ”€â”€ 03-select-best.step.ts
â”‚       â”œâ”€â”€ 04-post-tweet.step.ts
â”‚       â””â”€â”€ 05-write-result.step.ts
â”œâ”€â”€ motia.config.js                     # Motia configuration
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ .env.example
â”œâ”€â”€ README.md
â””â”€â”€ TWEET_RESULT.md                     # Generated output
```

---

## ğŸ” X API Setup

To get your X Bearer Token:

1. Go to [X Developer Portal](https://developer.twitter.com/)
2. Create a new App
3. Generate API v2 Bearer Token
4. Copy token to `.env` â†’ `X_BEARER_TOKEN`

**Permissions needed**: Read and Write tweets

---

## ğŸš¨ Error Handling

Custom error classes:

- `AIGenerationError`: OpenAI API failures
- `XAPIError`: X API failures
- `TweetValidationError`: Tweet validation failures
- `FileWriteError`: File system errors

All errors are:
- Logged to console
- Included in Motia observability
- Returned with proper HTTP status codes

---

## ğŸ¯ Differences from n8n

| Feature | n8n | Motia (Day-5) |
|---------|-----|---------------|
| Configuration | Visual GUI | TypeScript Code |
| Type Safety | Limited | Full Zod validation |
| Caching | Manual | Built-in |
| Error Handling | Basic | Custom error classes |
| Testing | External tools | Mock mode built-in |
| DDD Pattern | No | Yes |
| Event-Driven | Yes | Yes |
| Observability | Basic | Full plugin |

---

## ğŸ”® Future Enhancements

- [ ] Thread support (tweet multiple parts)
- [ ] Image generation + attachment
- [ ] Scheduling (post at specific time)
- [ ] Analytics tracking
- [ ] Multiple account support
- [ ] Sentiment analysis before posting
- [ ] Rate limiting middleware
- [ ] Redis for caching in production

---

## ğŸ“š Related Days

- **Day-1**: GitHub Release Notifier
- **Day-2**: GitHub Issue Auto-Labeler
- **Day-3**: Contributor Welcome Bot
- **Day-4**: AI Issue Picker

---

## ğŸ¤ Contributing

Follow the same DDD patterns as Day-1 through Day-4:

1. Services contain **all external API logic**
2. Steps only **orchestrate** and **emit events**
3. Use **Zod** for validation
4. Add **custom errors** for each layer
5. Keep **payloads small**
6. Add **caching** where appropriate

---

## ğŸ“„ License

MIT

---

**Built with â¤ï¸ using Motia Framework**

*Challenge: #30Days30Automations | Day: 5/30*
